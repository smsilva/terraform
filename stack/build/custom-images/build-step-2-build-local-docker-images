#!/bin/bash

TARGET_DIRECTORY="$1"

while read -r DIRECTORY; do
  source "${DIRECTORY}/build.conf"

  docker build \
    -t ${STACK_NAME?}:${STACK_VERSION?}-${ENVIRONMENT_NAME?} \
    -f ${DIRECTORY?}/Dockerfile ${DIRECTORY?}/

done <<< "$(find "${TARGET_DIRECTORY}" -mindepth 1 -maxdepth 1 -type d)"
