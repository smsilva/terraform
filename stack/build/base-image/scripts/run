#!/bin/sh
export TERRAFORM_COMMAND="$@"
export TERRAFORM_PLAN_FILE="/stack/output/terraform.plan"
export PATH=/stack:${PATH}

loadconfig /stack/stack.conf
loadconfig /stack/backend.conf

# Export Loaded Parameters as Environment Variables
. /stack/environment-variables.conf

create-auto-tfvars-file

show-debug-information

if [ "${TERRAFORM_COMMAND}" == "plan" ] || [ -z "${TERRAFORM_COMMAND}" ]; then
  plan
  exit 0
fi

if [ "${TERRAFORM_COMMAND}" == "apply" ]; then
  apply
  exit 0
fi

terraform "$@"
